#!/usr/bin/env bash

#
# This script runs screenshot tests to check if pages render identically at 
# a local development server and the production server.
#
# Usage:
#   ./runScreenshotTests [target_paths ...]
#
# If no target paths are specified, the script will run tests for all valid
# target paths.
#

set -e

bold_green='\033[1;32m'
bold_red='\033[1;31m'
default_color='\033[0m'
magenta='\033[0;35m'

fail="[${bold_red}FAIL${default_color}]"
pass="[${bold_green}PASS${default_color}]"

viewport_widths=(375 1024)

if [ $# -eq 0 ]
then
    num_posts=$(ls src/posts/*.vue | wc -l)
    target_paths=("" $(seq 1 $num_posts))
else
    target_paths=("$@")
fi

for target_path in "${target_paths[@]}"
do
    for viewport_width in "${viewport_widths[@]}"; do
        echo -e "Target path: ${magenta}$target_path${default_color}"
        echo -e "Viewport width: ${magenta}$viewport_width${default_color}"
        ./comparePages $target_path $viewport_width || {
            echo -e "${fail} Page screenshots are not identical."
            exit 1
        }
        echo -e "${pass} Page screenshots are identical."
    done 
done

echo -e "\n${bold_green}SUCCESS${default_color}: All tests passed!"